<html>
<head>
    <script src="http://d3js.org/d3.v3.js"></script>
</head>
<style>
    body {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .grid path,
    .grid line {
      fill: none;
      stroke: rgba(0, 0, 0, 0.25);
      shape-rendering: crispEdges;
    }

    .x.axis path {
      display: none;
    }

    .line {
      fill: none;
      stroke-width: 2.5px;
    }
</style>
{% extends 'layout.html' %}
{% block body %}
<h1> </h1>
<h1> Calculated Grade </h1>
<br>
<object>
  <strong> Pre-Curve: </strong> {{grade}}%
</object>
<br>
<br>
<object>
    <strong>Post-Curve Grade:</strong> <b id="pcGrade"></b>
</object>
<br>
    <div class="row">
        <div class="col-sm-3">
            <div class="well">
                <div class="form-group shiny-input-container">
                    <br>
                    <label for="sd">Mean:</label>
                    <input id="mean" type="number" class="form-control" value="70" min="0" max="100" step="0.01"/>
                </div>
                <div class="form-group shiny-input-container">
                    <label for="sd">Standard Deviation:</label>
                    <input id="sd" type="number" class="form-control" value="10" min="0.01" max="30" step="0.01"/>
                </div>
                <br>
                <button type="submit" class="btn btn-primary" onclick="pcGrade({{grade}})">Submit</button>
                <script>
                    function pcGrade(grade) {
                        let m = document.getElementById("mean").value;
                        let s = document.getElementById("sd").value;
                        if (s > 0 && m >= 0 && m <= 100) {
                            var z = (grade - m) / s;
                            if (z <= -1) {
                                document.getElementById("pcGrade").innerText = "F";
                                document.getElementById("pcGrade").style.color = "#990000";
                            } else if (z <= -0.5) {
                                document.getElementById("pcGrade").innerText = "D";
                                document.getElementById("pcGrade").style.color = "#ff00ff";
                            } else if (z <= 0.5) {
                                document.getElementById("pcGrade").innerText = "C";
                                document.getElementById("pcGrade").style.color = "#f28000";
                            } else if (z <= 1) {
                                document.getElementById("pcGrade").innerText = "B";
                                document.getElementById("pcGrade").style.color = "#0080ff";
                            } else {
                                document.getElementById("pcGrade").innerText = "A";
                                document.getElementById("pcGrade").style.color = "#0dc000";
                            }
                        } else {
                            var errMsg = "";
                            if (m < 0)
                                errMsg += "Mean must be positive!\n";
                            if (m > 100)
                                errMsg += "Mean is too large!\n";
                            if (s <= 0)
                                errMsg += "Standard Deviation must be non-zero!\n";
                            document.getElementById("pcGrade").innerHTML = errMsg;
                            document.getElementById("pcGrade").style.color = "black";
                        }
                    }
                </script>
            </div>
        </div>
        <div id="viz" class="col-sm-3">
            <script>
                function f(x, m, s) {
                    return (1 / (Math.sqrt(2*Math.PI)*s))*Math.exp(-1*(Math.pow(x-m,2)/(2*Math.pow(s,2))));
                }

                function linspace(start, end, n){
                    d = (end-start)/(n-1);
                    arr = [];
                    for (var i = 0; i < n; i++)
                        arr.push(start + i*d);
                    return arr;
                }

                x_pts = linspace(-3, 3, 100);
                y_pts = [];
                for (var i = 0; i < x_pts.length; i++)
                    y_pts.push(f(x_pts[i], 0, 1));

                var data = [ { label: "Data Set 1",
                               x: x_pts,
                               y: y_pts } ] ;
                var xy_chart = d3_xy_chart()
                    .width(960)
                    .height(500)
                    .xlabel("X Axis")
                    .ylabel("Y Axis") ;
                var svg = d3.select("#viz").append("svg")
                    .datum(data)
                    .call(xy_chart) ;

                function d3_xy_chart() {
                    var width = 640,
                        height = 480,
                        xlabel = "X Axis Label",
                        ylabel = "Y Axis Label" ;

                    function chart(selection) {
                        selection.each(function(datasets) {
                            //
                            // Create the plot.
                            //
                            var margin = {top: 20, right: 80, bottom: 30, left: 50},
                                innerwidth = width - margin.left - margin.right,
                                innerheight = height - margin.top - margin.bottom ;

                            var x_scale = d3.scale.linear()
                                .range([0, innerwidth])
                                .domain([ d3.min(datasets, function(d) { return d3.min(d.x); }),
                                          d3.max(datasets, function(d) { return d3.max(d.x); }) ]) ;

                            var y_scale = d3.scale.linear()
                                .range([innerheight, 0])
                                .domain([ d3.min(datasets, function(d) { return d3.min(d.y); }),
                                          d3.max(datasets, function(d) { return d3.max(d.y); }) ]) ;

                            var color_scale = d3.scale.category10()
                                .domain(d3.range(datasets.length)) ;

                            var x_axis = d3.svg.axis()
                                .scale(x_scale)
                                .orient("bottom") ;

                            var y_axis = d3.svg.axis()
                                .scale(y_scale)
                                .orient("left") ;

                            var x_grid = d3.svg.axis()
                                .scale(x_scale)
                                .orient("bottom")
                                .tickSize(-innerheight)
                                .tickFormat("") ;

                            var y_grid = d3.svg.axis()
                                .scale(y_scale)
                                .orient("left")
                                .tickSize(-innerwidth)
                                .tickFormat("") ;

                            var draw_line = d3.svg.line()
                                .interpolate("basis")
                                .x(function(d) { return x_scale(d[0]); })
                                .y(function(d) { return y_scale(d[1]); }) ;

                            var svg = d3.select(this)
                                .attr("width", width)
                                .attr("height", height)
                                .append("g")
                                .attr("transform", "translate(" + margin.left + "," + margin.top + ")") ;

                            svg.append("g")
                                .attr("class", "x grid")
                                .attr("transform", "translate(0," + innerheight + ")")
                                .call(x_grid) ;

                            svg.append("g")
                                .attr("class", "y grid")
                                .call(y_grid) ;

                            svg.append("g")
                                .attr("class", "x axis")
                                .attr("transform", "translate(0," + innerheight + ")")
                                .call(x_axis)
                                .append("text")
                                .attr("dy", "-.71em")
                                .attr("x", innerwidth)
                                .style("text-anchor", "end") ;

                            var data_lines = svg.selectAll(".d3_xy_chart_line")
                                .data(datasets.map(function(d) {return d3.zip(d.x, d.y);}))
                                .enter().append("g")
                                .attr("class", "d3_xy_chart_line") ;

                            data_lines.append("path")
                                .attr("class", "line")
                                .attr("d", function(d) {return draw_line(d); })
                                .attr("stroke", function(_, i) {return color_scale(i);}) ;

                            data_lines.append("text")
                                .attr("transform", function(d) {
                                    return ( "translate(" + x_scale(d.final[0]) + "," +
                                             y_scale(d.final[1]) + ")" ) ; })
                                .attr("x", 3)
                                .attr("dy", ".35em")
                                .attr("fill", function(_, i) { return color_scale(i); })
                                .text(function(d) { return d.name; }) ;

                        }) ;
                    }

                    chart.width = function(value) {
                        if (!arguments.length) return width;
                        width = value;
                        return chart;
                    };

                    chart.height = function(value) {
                        if (!arguments.length) return height;
                        height = value;
                        return chart;
                    };

                    chart.xlabel = function(value) {
                        if(!arguments.length) return xlabel ;
                        xlabel = value ;
                        return chart ;
                    } ;

                    chart.ylabel = function(value) {
                        if(!arguments.length) return ylabel ;
                        ylabel = value ;
                        return chart ;
                    } ;

                    return chart;
                }
            </script>
        </div>
    </div>
    <br>
{% endblock %}
</html>